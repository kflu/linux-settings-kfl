#!/bin/sh

usage=$(cat <<EOF
Usage:
    [-x]

-x: kill dashboard session
EOF
)

while getopts 'xh' opt; do
    case "$opt" in
        x)
            kill=1;;
        h)
            echo "$usage" >&2; exit 0;;
    esac
done
shift $((OPTIND-1))

if [ $kill ]; then
    tmux kill-session -t dash >/dev/null 2>&1
    exit 0
fi

if ! tmux has-session -t dash >/dev/null 2>&1; then
    tmux new-session -s dash -d -x 205 -y 25
    console_id=$(tmux display -t dash -p "#{pane_id}")
    cal_id=$(tmux split-window -t dash -P -F "#{pane_id}" -b -v "while true; do clear; cal; sleep 3; done")
    info_id=$(tmux split-window -t dash -P -F "#{pane_id}" -h "dash-info")
    weather_id=$(tmux split-window -t dash -P -F "#{pane_id}" -h 'while true; do clear; curl "wttr.in/seattle?0Q"; sleep 3600; done')
    weather2_id=$(tmux split-window -t dash -P -F "#{pane_id}" -h 'while true; do clear; weather; sleep 3600; done')
    htop_id=$(tmux split-window -t dash -P -F "#{pane_id}" -h "htop")

    tmux resize-pane -t "dash:^.${cal_id}" -x 25 -y 11
    tmux resize-pane -t "dash:^.${info_id}" -x 20
    tmux resize-pane -t "dash:^.${weather_id}" -x 30 
    tmux resize-pane -t "dash:^.${htop}" -x 65
    tmux resize-pane -t "dash:^.${weather2_id}" -x 65

    # disable input to these panes
    for id in "$cal_id" "$htop_id" "$info_id" "$weather_id" "$weather2_id"; do
        tmux select-pane -t "dash:^.${id}" -d
    done

    # activate console pane
    tmux select-pane -t "dash:^.${console_id}"
fi

tmux a -t dash 
